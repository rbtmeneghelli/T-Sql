SET NOCOUNT ON;

-- Create common password list
IF OBJECT_ID('tempdb..#SenhasFracas') IS NOT NULL 
  DROP TABLE #SenhasFracas;
CREATE TABLE #SenhasFracas (Senha VARCHAR(30) PRIMARY KEY);
INSERT INTO #SenhasFracas VALUES 
('123456'),('password'),('admin'),('welcome'),('qwerty'),
('123456789'),('111111'),('123123'),('senha'),('12345');

-- Detect vulnerability
SELECT 'VULNERAVEL - ALTERAR SENHA' AS Alerta,
    name AS Login,
    create_date AS Criado_em,
    CASE is_disabled 
     WHEN 0 THEN 'ATIVO' 
     ELSE 'DESATIVADO' 
    END AS Status
FROM sys.sql_logins sl
WHERE EXISTS (SELECT 1 FROM #SenhasFracas sf 
       WHERE PWDCOMPARE(sf.Senha, sl.password_hash) = 1)
  OR PWDCOMPARE(sl.name, sl.password_hash) = 1 -- Login = Senha!
ORDER BY name;